---
title: Deja Vu
background: https://cdna.artstation.com/p/assets/images/images/001/096/914/large/sandra-knego-monotonous-and-confused.jpg?1439983243
layout: post
artist: artstation.com/sandraknego
subtitle: It's all happened already.
---

```csharp
public List<Tile> Search(Tile start, Func<Tile, Tile, decimal, bool> addTile, Func< Point[]> addDirs, Func<Tile, Tile, decimal> travelCost)
{
  List<Tile> retValue = new List<Tile>();
  dirs = addDirs();
  retValue.Add(start);

  ClearSearch();
  Queue<Tile> checkNext = new Queue<Tile>();
  Queue<Tile> checkNow = new Queue<Tile>();

  start.distance = 0;
  checkNow.Enqueue(start);

  while (checkNow.Count > 0)
  {
    Tile t = checkNow.Dequeue();
    for (int i = 0; i < dirs.Length; ++i)
    {
      bool validTileFound = false;
      if (t.pos.x + dirs[i].x < this._mapMin.x || t.pos.x + dirs[i].x > this._mapMax.x || t.pos.z + dirs[i].z < this._mapMin.z || t.pos.z + dirs[i].z > this._mapMax.z)
        continue;
      for (int y = this._mapMin.y; y <= this._mapMax.y; ++y)
      {
        Tile next = GetTile(new Point(t.pos.x + dirs[i].x, y, t.pos.z + dirs[i].z));

        if (next == null)
        {
          if (y >= this._mapMax.y && validTileFound == false)
          {
            GameObject instance = Instantiate(tilePrefab) as GameObject;
            instance.SetActive(false);
            next = instance.GetComponent<Tile>();
            next.pos = t.pos + dirs[i];
            next.tileType = TileType.air;
            next.tileContent = TileContent.none;
            next.distance = int.MaxValue;
          }
          else
          {
            continue;
          }
        }
        else
        {
          validTileFound = true;
        }

        decimal cost = travelCost(t, next);
        if (next.distance <= t.distance + cost)
          continue;

        if (addTile(t, next, cost))
        {
          next.distance = t.distance + cost;
          next.prev = t;
          checkNext.Enqueue(next);
          retValue.Add(next);
        }
      }
    }
    if (checkNow.Count == 0)
      SwapReference(ref checkNow, ref checkNext);

  }
  return retValue;
}

```
